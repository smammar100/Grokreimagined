var xt=Object.defineProperty;var wt=(a,t,e)=>t in a?xt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var r=(a,t,e)=>wt(a,typeof t!="symbol"?t+"":t,e);import{_ as M}from"./index-D_Pu1o9T.js";import{V as f,a as V,u as d,S as yt,F as b,b as vt,T as Pt,c as N,L as Lt,W as zt,P as Mt,d as Pe,A as Ie,N as St,e as Tt,C as Ct,R as _t,f as Rt,g as Dt,M as kt,h as B,s as de,i as P,v as S,j as l,k as c,l as Et,m as _,n as At,I as w,o as Vt,p as m,q as _e,r as U,t as re,w as C,x as Bt,y as ce,z as Z,B as Ft,D as O,E as It,G,H as v,J as Ne,K as Nt,O as q,Q as Ot,U as Ye,X as Wt,Y as Le,Z as jt,_ as Xt,$ as Ht,a0 as J,a1 as qt,a2 as Re,a3 as Yt,a4 as K,a5 as Ut,a6 as Gt,a7 as De,a8 as Jt,a9 as Zt,aa as Kt,ab as le,ac as Qt,ad as $t,ae as es,af as ts,ag as ss,ah as is,ai as Ue,aj as ns,ak as as,al as os,am as rs,an as cs,ao as ls,ap as hs,aq as ds,ar as us,as as ms,at as ps,au as Oe,av as bs,aw as fs,ax as gs,ay as xs,az as ws,aA as ys,aB as vs,aC as Ps,aD as Ls,aE as zs,aF as Ms,aG as Ss,aH as Ts,aI as Cs,aJ as _s,aK as Rs,aL as ve,aM as Ds,aN as We}from"./vendor-three-BAfSiKEZ.js";import{g as ze,M as ks}from"./vendor-gsap-BokNN65F.js";import"./vendor-CfdXZR72.js";import"./vendor-react-BMVhqXZL.js";class F{constructor(){this.callbacks={},this.callbacks.base={}}on(t,e){return typeof t>"u"||t===""?(console.warn("wrong names"),!1):typeof e>"u"?(console.warn("wrong callback"),!1):(this.resolveNames(t).forEach(i=>{const n=this.resolveName(i);this.callbacks[n.namespace]instanceof Object||(this.callbacks[n.namespace]={}),this.callbacks[n.namespace][n.value]instanceof Array||(this.callbacks[n.namespace][n.value]=[]),this.callbacks[n.namespace][n.value].push(e)}),this)}off(t){return typeof t>"u"||t===""?(console.warn("wrong name"),!1):(this.resolveNames(t).forEach(s=>{const i=this.resolveName(s);if(i.namespace!=="base"&&i.value==="")delete this.callbacks[i.namespace];else if(i.namespace==="base")for(const n in this.callbacks)this.callbacks[n]instanceof Object&&this.callbacks[n][i.value]instanceof Array&&(delete this.callbacks[n][i.value],Object.keys(this.callbacks[n]).length===0&&delete this.callbacks[n]);else this.callbacks[i.namespace]instanceof Object&&this.callbacks[i.namespace][i.value]instanceof Array&&(delete this.callbacks[i.namespace][i.value],Object.keys(this.callbacks[i.namespace]).length===0&&delete this.callbacks[i.namespace])}),this)}trigger(t,e){if(typeof t>"u"||t==="")return console.warn("wrong name"),!1;let s=null;const i=e instanceof Array?e:[];let n=this.resolveNames(t);if(n=this.resolveName(n[0]),n.namespace==="base")for(const o in this.callbacks)this.callbacks[o]instanceof Object&&this.callbacks[o][n.value]instanceof Array&&this.callbacks[o][n.value].forEach(function(h){h.apply(this,i)});else if(this.callbacks[n.namespace]instanceof Object){if(n.value==="")return console.warn("wrong name"),this;this.callbacks[n.namespace][n.value].forEach(function(o){o.apply(this,i)})}return s}resolveNames(t){let e=t;return e=e.replace(/[^a-zA-Z0-9 ,/.]/g,""),e=e.replace(/[,/]+/g," "),e=e.split(" "),e}resolveName(t){const e={},s=t.split(".");return e.original=t,e.value=s[0],e.namespace="base",s.length>1&&s[1]!==""&&(e.namespace=s[1]),e}}function Me(a,t,e,s=void 0){const i=new f(a,t,.5);i.unproject(e);const n=i.sub(e.position).normalize(),o=new f;return e.getWorldDirection(o),s||(s=-e.position.dot(o)/n.dot(o)),e.position.clone().add(n.multiplyScalar(s))}function Es(a,t){const e=t.width/t.height,s=a.image.width/a.image.height,i=new V(1,1),n=new V(0,0);return e>s?(i.y=s/e,n.y=(1-i.y)/2):(i.x=e/s,n.x=(1-i.x)/2),{uvScale:i,uvOffset:n}}class As extends F{constructor(){super(),this.exprience=g.getInstance(),this.isMobile=this.exprience.isMobile,this.pixelRatio=this.isMobile?1:Math.min(window.devicePixelRatio,2),this.width=window.innerWidth,this.height=window.innerHeight,this.width_DPR=this.width*window.devicePixelRatio,this.height_DPR=this.height*window.devicePixelRatio,this.aspectRatio=this.width/this.height,this.uniforms={resolution:d(new V(this.width,this.height)),aspectRatio:d(this.aspectRatio),width_DPR:d(this.width_DPR),height_DPR:d(this.height_DPR)},window.addEventListener("resize",()=>{this.pixelRatio=this.isMobile?1:Math.min(window.devicePixelRatio,2),this.width=window.innerWidth,this.height=window.innerHeight,this.width_DPR=this.width*window.devicePixelRatio,this.height_DPR=this.height*window.devicePixelRatio,this.aspectRatio=this.width/this.height,this.uniforms.resolution.value.set(this.width,this.height),this.uniforms.aspectRatio.value=this.aspect,this.uniforms.width_DPR.value=this.width_DPR,this.uniforms.height_DPR.value=this.height_DPR,this.trigger("resize")})}}class Vs{constructor(){r(this,"experience",g.getInstance());r(this,"sizes",this.experience.sizes);this.active=!1,this.active&&Promise.all([M(()=>import("./vendor-CfdXZR72.js").then(t=>t.s),[],import.meta.url),M(()=>import("./vendor-CfdXZR72.js").then(t=>t.d),[],import.meta.url)]).then(([t,{Pane:e}])=>{const s=t.default;this.panel=new e({title:"Debug",container:document.getElementById("debug-panel"),expanded:!1}),this.stats=new s,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)})}postInit(){this.scene=this.experience.scene}createDebugNode(t,e){this.debugNode=t,this.world=e,this.scene=e.scene,this.camera=e.camera.instance;const s=new yt({depthTest:!1,toneMapped:!1});t.isNode&&(s.colorNode=b(()=>t)());const i=this.sprite=new vt(s);i.center.set(0,0),i.renderOrder=1e4,this.scene.add(i),this._updateSprite()}_updateSprite(){if(!this.debugNode)return;const t=Me(-1,-1,this.camera,10);this.sprite.position.copy(t)}resize(){this._updateSprite()}update(t){this.debugNode&&this._updateSprite()}}class Bs extends F{constructor(){super(),this.timer=new Pt,this.start=Date.now(),this.current=this.start,this.playing=!0,this.elapsed=0,this.delta=.016666666666666666,this.deltaSim=.016666666666666666,this.timeline=ze.timeline({paused:!0}),window.requestAnimationFrame(()=>{this.tick()})}tick(){this.timer.update(),this.delta=this.timer.getDelta(),this.elapsed=this.timer.getElapsed(),this.timeline.time(this.elapsed),this.trigger("tick"),window.requestAnimationFrame(()=>{this.tick()})}reset(){this.start=Date.now(),this.current=this.start,this.elapsed=0}}class Fs{constructor(){r(this,"experience",g.getInstance());r(this,"sizes",this.experience.sizes);r(this,"renderer",this.experience.renderer.instance);r(this,"postprocessing",!0);r(this,"uniforms",{resolution:d(new V(this.sizes.width_DPR,this.sizes.height_DPR)),mainScene:{environment:{topColor:d(N(296930)),bottomColor:d(N(26367)),fogColor:d(N(0)),fogNear:d(0),fogFar:d(47.83),backgroundIntensity:2},bloomPass:{strength:d(.217),radius:d(0),threshold:d(.4)}}});this.experience=g.getInstance(),this.renderer=this.experience.renderer.instance,this.canvas=this.experience.canvas,this.sizes=this.experience.sizes,this.setLayers()}setLayers(){this.layersConst={BLOOM_SCENE:1,DEFAULT:0},this.bloomLayer=new Lt,this.bloomLayer.set(this.layersConst.BLOOM_SCENE)}resize(){this.uniforms.resolution.value.set(this.sizes.width_DPR,this.sizes.height_DPR)}}class Is{constructor(){this.experience=new g,this.canvas=this.experience.canvas,this.sizes=this.experience.sizes,this.debug=this.experience.debug,this.resources=this.experience.resources,this.html=this.experience.html,this.setInstance(),this.setDebug()}postInit(){this.camera=this.experience.mainCamera.instance,this.scene=this.experience.mainScene,this.state=this.experience.state}setInstance(){this.clearColor="#010101",this.instance=new zt({canvas:this.canvas,antialias:!0,alpha:!1,stencil:!1,depth:!0,useLegacyLights:!1,physicallyCorrectLights:!0,forceWebGL:!1}),this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=Mt,this.instance.outputColorSpace=Pe,this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(Math.min(this.sizes.pixelRatio,2)),this.instance.setClearColor(this.clearColor,1),this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.toneMapping=Ie,this.instance.toneMappingExposure=1.2}setDebug(){if(this.debug.active&&this.debug.panel){const t=this.debug.panel.addFolder({title:"Renderer",expanded:!1});t.addBinding(this.instance,"toneMapping",{label:"Tone Mapping",options:{No:Dt,Linear:Rt,Reinhard:_t,Cineon:Ct,ACESFilmic:Ie,AgXToneMapping:Tt,NeutralToneMapping:St}}).on("change",()=>{this.state.postprocessing&&(this.experience.postProcess.composer.needsUpdate=!0)}),t.addBinding(this.instance,"toneMappingExposure",{min:0,max:2,step:.01,label:"Tone Mapping Exposure"})}}update(){this.debug.active?this.debugRender():this.productionRender()}productionRender(){this.instance.renderAsync(this.scene,this.camera)}debugRender(){this.instance.renderAsync(this.scene,this.camera)}resize(){this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}destroy(){}}class Ge extends HTMLElement{constructor(t,e){super(),this.camera=t,this.options=Object.assign({size:90,padding:8,bubbleSizePrimary:8,bubbleSizeSeconday:6,showSecondary:!0,lineWidth:2,fontSize:"11px",fontFamily:"arial",fontWeight:"bold",fontColor:"#151515",fontYAdjust:0,colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}},e),this.onAxisSelected=null,this.bubbles=[{axis:"x",direction:new f(1,0,0),size:this.options.bubbleSizePrimary,color:this.options.colors.x,line:this.options.lineWidth,label:"X"},{axis:"y",direction:new f(0,1,0),size:this.options.bubbleSizePrimary,color:this.options.colors.y,line:this.options.lineWidth,label:"Y"},{axis:"z",direction:new f(0,0,1),size:this.options.bubbleSizePrimary,color:this.options.colors.z,line:this.options.lineWidth,label:"Z"},{axis:"-x",direction:new f(-1,0,0),size:this.options.bubbleSizeSeconday,color:this.options.colors.x},{axis:"-y",direction:new f(0,-1,0),size:this.options.bubbleSizeSeconday,color:this.options.colors.y},{axis:"-z",direction:new f(0,0,-1),size:this.options.bubbleSizeSeconday,color:this.options.colors.z}],this.center=new f(this.options.size/2,this.options.size/2,0),this.selectedAxis=null,this.innerHTML="<canvas width='"+this.options.size+"' height='"+this.options.size+"'></canvas>",this.onMouseMove=this.onMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseClick=this.onMouseClick.bind(this)}connectedCallback(){this.canvas=this.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("mousemove",this.onMouseMove,!1),this.canvas.addEventListener("mouseout",this.onMouseOut,!1),this.canvas.addEventListener("click",this.onMouseClick,!1)}disconnectedCallback(){this.canvas.removeEventListener("mousemove",this.onMouseMove,!1),this.canvas.removeEventListener("mouseout",this.onMouseOut,!1),this.canvas.removeEventListener("click",this.onMouseClick,!1)}onMouseMove(t){const e=this.canvas.getBoundingClientRect();this.mouse=new f(t.clientX-e.left,t.clientY-e.top,0)}onMouseOut(t){this.mouse=null}onMouseClick(t){this.onAxisSelected&&typeof this.onAxisSelected=="function"&&this.onAxisSelected({axis:this.selectedAxis.axis,direction:this.selectedAxis.direction.clone()})}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}drawCircle(t,e=10,s="#FF0000"){this.context.beginPath(),this.context.arc(t.x,t.y,e,0,2*Math.PI,!1),this.context.fillStyle=s,this.context.fill(),this.context.closePath()}drawLine(t,e,s=1,i="#FF0000"){this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.lineWidth=s,this.context.strokeStyle=i,this.context.stroke(),this.context.closePath()}update(){this.clear();let e=new kt().makeRotationFromEuler(this.camera.rotation).clone().invert();for(var s of this.bubbles)s.position=this.getBubblePosition(s.direction.clone().applyMatrix4(e));const i=[];for(let n in this.bubbles)(this.options.showSecondary===!0||n[0]!=="-")&&i.push(this.bubbles[n]);if(i.sort((n,o)=>n.position.z>o.position.z?1:-1),this.selectedAxis=null,this.mouse){let n=1/0;for(var s of i){const h=this.mouse.distanceTo(s.position);(h<n||h<s.size)&&(n=h,this.selectedAxis=s)}}this.drawLayers(i)}drawLayers(t){for(let e of t){let s=e.color;this.selectedAxis===e?s="#FFFFFF":e.position.z>=-.01?s=e.color[0]:s=e.color[1],this.drawCircle(e.position,e.size,s),e.line&&this.drawLine(this.center,e.position,e.line,s),e.label&&(this.context.font=[this.options.fontWeight,this.options.fontSize,this.options.fontFamily].join(" "),this.context.fillStyle=this.options.fontColor,this.context.textBaseline="middle",this.context.textAlign="center",this.context.fillText(e.label,e.position.x,e.position.y+this.options.fontYAdjust))}}getBubblePosition(t){return new f(t.x*(this.center.x-this.options.bubbleSizePrimary/2-this.options.padding)+this.center.x,this.center.y-t.y*(this.center.y-this.options.bubbleSizePrimary/2-this.options.padding),t.z)}}window.customElements.define("gizmo-helper",Ge);Bt.setParameterLength(1);b(([a])=>{const t=c(a).toVar(),e=c(ce(t)).toVar();return Z(Z(e.x,e.y),e.z)}).setLayout({name:"facture",type:"float",inputs:[{name:"vector",type:"vec3"}]});b(([a,t])=>{const e=l(t).toVar();return c(a).toVar().mul(e)}).setLayout({name:"emission",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"strength",type:"float"}]});const T=b(([a])=>{const t=c(a).toVar();return t.assign(c(P(t,c(127.1,311.7,74.7)),P(t,c(269.5,183.3,246.1)),P(t,c(113.5,271.9,124.6)))),l(-1).add(C(2,B(de(t).mul(43758.5453123))))}).setLayout({name:"hash",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Ns=b(([a,t])=>{const e=l(t).toVar(),s=c(a).toVar(),i=l(de(e)).toVar(),n=l(Et(e)).toVar(),o=l(_(1,n)).toVar();return At(o.mul(s.x).mul(s.x).add(n),o.mul(s.x).mul(s.y).sub(s.z.mul(i)),o.mul(s.z).mul(s.x).add(s.y.mul(i)),o.mul(s.x).mul(s.y).add(s.z.mul(i)),o.mul(s.y).mul(s.y).add(n),o.mul(s.y).mul(s.z).sub(s.x.mul(i)),o.mul(s.z).mul(s.x).sub(s.y.mul(i)),o.mul(s.y).mul(s.z).add(s.x.mul(i)),o.mul(s.z).mul(s.z).add(n))}).setLayout({name:"rotateAxis",type:"mat3",inputs:[{name:"axis",type:"vec3"},{name:"angle",type:"float"}]}),Os=b(([a])=>{const t=c(a).toVar(),e=c(O(t)).toVar(),s=c(B(t)).toVar(),i=c(s.mul(s).mul(_(3,C(2,s)))).toVar();return m(m(m(P(T(e.add(c(0,0,0))),s.sub(c(0,0,0))),P(T(e.add(c(1,0,0))),s.sub(c(1,0,0))),i.x),m(P(T(e.add(c(0,1,0))),s.sub(c(0,1,0))),P(T(e.add(c(1,1,0))),s.sub(c(1,1,0))),i.x),i.y),m(m(P(T(e.add(c(0,0,1))),s.sub(c(0,0,1))),P(T(e.add(c(1,0,1))),s.sub(c(1,0,1))),i.x),m(P(T(e.add(c(0,1,1))),s.sub(c(0,1,1))),P(T(e.add(c(1,1,1))),s.sub(c(1,1,1))),i.x),i.y),i.z)}).setLayout({name:"noise",type:"float",inputs:[{name:"p",type:"vec3",qualifier:"in"}]}),Ws=b(([a])=>{const t=c(a).toVar();return c(t.x,Os(t.mul(.02)).mul(10),t.z)}).setLayout({name:"terrainHeight",type:"vec3",inputs:[{name:"worldPos",type:"vec3"}]}),js=b(([a])=>{const t=c(a).toVar(),e=l(t.r).toVar(),s=l(t.g).toVar(),i=l(t.b).toVar(),n=l(Z(e,Z(s,i))).toVar(),o=l(G(e,G(s,i))).toVar(),h=l(n.sub(o)).toVar(),u=l(0).toVar(),p=l(0).toVar(),y=l(n).toVar();return w(h.greaterThan(1e-5),()=>{p.assign(h.div(n)),w(e.equal(n),()=>{u.assign(s.sub(i).div(h))}).ElseIf(s.equal(n),()=>{u.assign(re(2,i.sub(e).div(h)))}).Else(()=>{u.assign(re(4,e.sub(s).div(h)))}),u.assign(u.div(6)),w(u.lessThan(0),()=>{u.addAssign(1)})}),c(u,p,y)}).setLayout({name:"rgb_to_hsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),Xs=b(([a])=>{const t=c(a).toVar(),e=l(t.x).toVar(),s=l(t.y).toVar(),i=l(t.z).toVar();w(s.lessThanEqual(0),()=>c(i)),e.assign(B(e).mul(6));const n=q(O(e)).toVar(),o=l(e.sub(l(n))).toVar(),h=l(i.mul(_(1,s))).toVar(),u=l(i.mul(_(1,s.mul(o)))).toVar(),p=l(i.mul(_(1,s.mul(_(1,o))))).toVar();return w(n.equal(q(0)),()=>c(i,p,h)),w(n.equal(q(1)),()=>c(u,i,h)),w(n.equal(q(2)),()=>c(h,i,p)),w(n.equal(q(3)),()=>c(h,u,i)),w(n.equal(q(4)),()=>c(p,h,i)),c(i,h,u)}).setLayout({name:"hsv_to_rgb",type:"vec3",inputs:[{name:"c",type:"vec3"}]});b(([a,t,e,s])=>{const i=a.clamp(0,1),n=t.toVar(),o=e.toVar(),h=Ft(0,s,i);return m(n,o,h)});b(([a,t,e,s,i])=>{const n=js(a).toVar(),o=t.sub(.5);n.x=B(n.x.add(o)),n.y.mulAssign(e),n.z.mulAssign(s);const h=Xs(n);return m(a,h,i)});const Hs=b(([a])=>m(a.div(12.92),_e(re(a,.055).div(1.055),c(2.4)),U(.04045,a))),qs=b(([a])=>{const t=a.mul(12.92),e=_e(a,c(1/2.4)).mul(1.055).sub(.055);return m(t,e,U(.0031308,a))});b(({inputVector:a,scale:t,brickWidth:e,rowHeight:s,mortar:i,offset:n,freq:o,squash:h,squashFreq:u,color1:p,color2:y,mortarColor:R,bias:Q,variance:$})=>{const W=a.toVar(),z=S(W.x.mul(t).div(e),W.y.mul(t).div(s)),x=O(z.y),ue=It(x,u),me=U(ue,1e-4),L=m(1,h,me),j=S(z.x.mul(L),z.y),X=O(x.div(o)),pe=x.sub(X.mul(o)),be=B(pe.mul(n)),ee=S(j.x.add(be),j.y),H=B(ee),ke=G(H.x,l(1).sub(H.x)),fe=G(H.y,l(1).sub(H.y)),te=l(i).mul(.5),ge=G(ke,fe),xe=U(ge,te),ie=S(O(ee.x),O(ee.y)),ne=B(de(ie.x.mul(12.9898).add(ie.y.mul(78.233))).mul(43758.5453)),ae=U(ne,l(Q));let I=m(p,y,ae);I=m(I,m(p,y,ne),l($));const we=m(I,R,xe);return v(we,1)});const je=b(([a])=>a.r.mul(.2126).add(a.g.mul(.7152)).add(a.b.mul(.0722)).toVar());b(([a,t,e])=>{const s=Z(l(0),G(l(1),e)),i=Ne(a),n=Ne(t),o=c(n.x,n.y,i.z),h=Nt(o);return m(a,h,s)});const Xe=b(([a,t,e,s,i])=>C(.5,C(2,s).add(i.negate().add(e).mul(a)).add(C(2,i).sub(C(5,s)).add(C(4,e)).sub(t).mul(a).mul(a)).add(i.negate().add(C(3,s)).sub(C(3,e)).add(t).mul(a).mul(a).mul(a))),{T:"float",D:"vec3",C:"vec3",B:"vec3",A:"vec3",return:"vec3"}),Ys=b(([a,t,e,s])=>{const i=e.w.sub(t.w),n=s.w.sub(e.w),o=a.sub(t.w).div(i).saturate(),h=a.sub(e.w).div(n).saturate(),u=c(_(1,o),o.sub(h),h),p=Xe(u.x,t.xyz,t.xyz,e.xyz,s.xyz),y=Xe(u.y,t.xyz,e.xyz,s.xyz,s.xyz),R=s.xyz;return w(a.lessThan(e.w),()=>p.xyz),w(a.lessThan(s.w),()=>y.xyz),R.xyz},{T:"float",A:"vec4",B:"vec4",C:"vec4",return:"vec3"}),Us=a=>B(de(P(a,S(12.9898,78.233))).mul(43758.5453)),se=b(([a])=>a.x.mul(a.x).add(a.y.mul(a.y)).add(a.z.mul(a.z)).sqrt()),He=b(([a,t,e,s,i])=>{const n=Vt(a.sub(t).div(e.sub(t)),0,1),o=n.mul(n).mul(l(3).sub(n.mul(2)));return m(s,i,o)},{value:"float",inMin:"float",inMax:"float",outMin:"float",outMax:"float",return:"float"}),he=new Ot({transparent:!0}),oe=Ye(c(0)),Gs=Ye(c(0));he.vertexNode=b(()=>{const a=v(Wt,1).toVar(),t=v(Le.mul(a)).toVar();return t.xyz.assign(Ws(t.xyz)),oe.assign(t.xyz),Gs.assign(ce(Le.mul(v(jt,0)).xyz)),Xt.mul(Ht.mul(t))})();he.colorNode=b(a=>{const t=J(a.material.map),e=l(t.sample(oe.xz.mul(.1)).r).toVar(),s=l(t.sample(oe.xz.mul(1)).r).toVar(),i=l(T(O(oe.xz.mul(1)))).toVar(),n=c(m(c(re(.5,qt(i,l(-1),1,l(-.2),.2))),c(.0625),s)).toVar();n.assign(m(n,c(.00625),e));const o=c(n).toVar();return v(_e(o,c(1/2.2)),.5)})();var qe;class Js{constructor(t={}){r(this,"experience",new g);r(this,"debug",experience.debug);r(this,"time",experience.time);r(this,"renderer",experience.renderer.instance);r(this,"resources",experience.resources);r(this,"cursor",experience.cursor);r(this,"timeline",experience.timeline);r(this,"controls",(qe=experience.camera)==null?void 0:qe.controls);r(this,"container",new Re);this.debug.active&&(this.world=t.world,this.scene=this.world.scene,this.camera=this.world.camera.instance,this.setupDebugFeatures())}setupDebugFeatures(){this.addViewHelper()}addGlobalAxes(){const t=new Yt(5);this.scene.add(t)}addViewHelper(){this.gizmo=new Ge(this.camera,{size:100,padding:8}),document.body.appendChild(this.gizmo),this.gizmo.onAxisSelected=function(t){console.log(t)}}addGrid(){const t=this.resources.items.gridTexture;t.wrapS=K,t.wrapT=K,t.generateMipmaps=!0,t.minFilter=Ut,t.magFilter=Gt,he.map=t;const e=new De(new Jt(200,200),he);e.rotateX(-Math.PI/2),this.scene.add(e)}resize(){}update(t){var e;(e=this.gizmo)==null||e.update()}}class Zs{constructor(t={}){this.experience=new g,this.renderer=this.experience.renderer.instance,this.sizes=this.experience.sizes,this.time=this.experience.time,this.canvas=this.experience.canvas,this.timeline=this.experience.timeline,this.scene=t.world.scene,this.cursorEnabled=!1,this.lerpVector=new f,this.setInstance(),this.setControls()}setInstance(){this.instance=new Zt(50,this.sizes.width/this.sizes.height,.1,2e3),this.defaultCameraPosition=new f(1,.5,3);const t=new f(0,0,0),e=new f().subVectors(this.defaultCameraPosition.clone(),t),s=new Kt().setFromVector3(e);s.phi+=le.degToRad(10),this.instance.position.copy(t.clone().add(new f().setFromSpherical(s))),this.instance.lookAt(t),this.lerpVector.copy(this.instance.position)}setControls(){this.controls=new Qt(this.instance,this.canvas),this.controls.enableDamping=!0,this.controls.minDistance=0,this.controls.maxDistance=1e3,this.controls.enabled=!0,this.controls.target=new f(0,0,0),this.controls.saveState(),this.transformControls=new $t(this.instance,this.renderer.domElement),this.transformControls.addEventListener("dragging-changed",t=>{this.controls.enabled=!t.value}),this.scene.add(this.transformControls.getHelper()),this._setListeners()}_setListeners(){const t=this.transformControls;window.addEventListener("keydown",e=>{switch(e.key){case"q":t.setSpace(t.space==="local"?"world":"local");break;case"Shift":t.setTranslationSnap(1),t.setRotationSnap(le.degToRad(15)),t.setScaleSnap(.25);break;case"w":t.setMode("translate");break;case"e":t.setMode("rotate");break;case"r":t.setMode("scale");break;case"+":case"=":t.setSize(t.size+.1);break;case"-":case"_":t.setSize(Math.max(t.size-.1,.1));break;case"x":t.showX=!t.showX;break;case"y":t.showY=!t.showY;break;case"z":t.showZ=!t.showZ;break;case" ":t.enabled=!t.enabled;break;case"Escape":t.reset();break}}),window.addEventListener("keyup",function(e){switch(e.key){case"Shift":t.setTranslationSnap(null),t.setRotationSnap(null),t.setScaleSnap(null);break}})}resize(){this.instance.aspect=this.sizes.width/this.sizes.height,this.instance.updateProjectionMatrix()}update(){var t;(t=this.controls)==null||t.update(),this.instance.updateMatrixWorld()}animateCameraPosition(){}}const D=class D{constructor(t={}){r(this,"_onMouseMoved",t=>{this.previosClient.x=this.clientX||t.clientX,this.previosClient.y=this.clientY||t.clientY,this.clientX=t.clientX/this.sizes.width,this.clientY=t.clientY/this.sizes.height,this.previosCursor.x=this.cursor.x,this.previosCursor.y=this.cursor.y,this.cursor.x=t.clientX/this.sizes.width*2-1,this.cursor.y=-(t.clientY/this.sizes.height)*2+1,this.cursor.side=t.clientX>this.sizes.width/2?"right":"left",this.previosCursor3D=this.cursor3D.clone(),this.cursor3D=Me(this.cursor.x,this.cursor.y,this.camera),this.cursorDirection=this.cursor3D.clone().sub(this.previosCursor3D).normalize();const e=this.clientX-this.previosClient.x,s=this.clientY-this.previosClient.y;this.cursorVelocity.set(e,s).divideScalar(this.time.delta),this.cursorVelocity.clamp(this.velocityMin,this.velocityMax)});r(this,"_onTouchStart",t=>{this._onTouchMoved(t)});r(this,"_onTouchMoved",t=>{this.previosClient.x=this.clientX||t.touches[0].clientX,this.previosClient.y=this.clientY||t.touches[0].clientY,this.clientX=t.touches[0].clientX,this.clientY=t.touches[0].clientY,this.cursor.x=t.touches[0].clientX/this.sizes.width*2-1,this.cursor.y=-(t.touches[0].clientY/this.sizes.height)*2+1,this.cursor.side=t.touches[0].clientX>this.sizes.width/2?"right":"left",this.previosCursor3D=this.cursor3D.clone(),this.cursor3D=Me(this.cursor.x,this.cursor.y,this.camera),this.cursorDirection=this.cursor3D.clone().sub(this.previosCursor3D).normalize();const e=this.clientX-this.previosClient.x,s=this.clientY-this.previosClient.y;this.cursorVelocity.set(e,s).divideScalar(this.time.delta),this.cursorVelocity.clamp(this.velocityMin,this.velocityMax)});if(D._instance)return D._instance;D._instance=this,this.experience=g.getInstance(),this.sizes=this.experience.sizes,this.time=this.experience.time,this.camera=t.camera,this.cursor={x:0,y:0,side:"left"},this.previosClient={x:0,y:0},this.previosCursor={x:0,y:0},this.cursor3D=new f,this.cursorDirection=new f,this.cursorVelocityCurrent=new V(0,0),this.cursorVelocity=new V(0,0),this.velocityMin=new V(-1,-1),this.velocityMax=new V(1,1),this.clientX=0,this.clientY=0,this.raycaster=new es,this.init()}static getInstance(){return D._instance||new D}init(){window.addEventListener("mousemove",this._onMouseMoved),window.addEventListener("touchstart",this._onTouchStart),window.addEventListener("touchmove",this._onTouchMoved)}postInit(){}getNDCFrom3d(t,e,s){const i=new f(t,e,s);return i.project(this.camera),i}update(){this.cursorVelocity.x=le.damp(this.cursorVelocity.x,0,3,this.time.delta),this.cursorVelocity.y=le.damp(this.cursorVelocity.y,0,3,this.time.delta)}};r(D,"_instance",null);let Se=D;class Ks{constructor(t={}){this.experience=new g,this.state=this.experience.state,this.world=t.world,this.scene=this.world.scene,this.resources=this.experience.resources,this.debug=this.experience.debug,this.renderer=this.experience.renderer.instance,this.uniforms=this.state.uniforms.mainScene.environment,this.scene.colorSpace=Pe,this.setEnvironmentMap(),this._setDebug()}setAmbientLight(){this.ambientLight=new ts("#ffffff",.3),this.scene.add(this.ambientLight)}setDirectionalLight(){const t=this.directionalLight=new ss("#ffffff",2);t.position.set(0,5,5),this.scene.add(t)}setEnvironmentMap(){this.resources.items.starsTexture.mapping=is,this.resources.items.starsTexture.colorSpace=Pe,this.resources.items.starsTexture.needsUpdate=!0,this.scene.backgroundNode=J(this.resources.items.starsTexture,Ue()).mul(this.state.uniforms.mainScene.environment.backgroundIntensity)}setBackground(){const t=ns.y.mix(this.uniforms.topColor,this.uniforms.bottomColor);this.scene.backgroundNode=t,this.scene.environmentNode=t}_setDebug(){if(this.debug.active){const t=this.world.debugFolder.addFolder({title:"Environment",expanded:!1});t.addBinding(this.uniforms.topColor,"value",{label:"Top Color",color:{type:"float"}}),t.addBinding(this.uniforms.bottomColor,"value",{label:"Bottom Color",color:{type:"float"}})}}}class Qs extends F{constructor(e){super();r(this,"experience",g.getInstance());r(this,"renderer",experience.renderer.instance);this.sources=e,this.items={},this.toLoad=this.sources.length,this.loaded=0,this.loadedAll=!1;const s=new Set(this.sources.map(i=>i.type));this.setLoaders(s),this.startLoading()}sourcesFilter(){this.sources.forEach(e=>{e.obfuscate===!0&&(e.type.match(/model/i)&&(e.path=e.path.replace(/\.(glb|gltf|obj)/i,".bin"),e.type="binModel"),e.type==="json"&&(e.path=e.path.replace(/\.(json)/i,".bin"),e.type="binJson"),e.type.match(/texture/i)&&(e.path=e.path.replace(/\.(jpg|jpeg|png)/i,".bin"),e.type="binTexture"))})}setLoaders(e){this.loaders={},this.loaders.textureLoader=new as,this.loaders.AudioLoader=new os,e.has("cubeTexture")&&(this.loaders.cubeTextureLoader=new rs),this._loaderPromises={}}_ensureGltfLoader(){return this._loaderPromises.gltfLoader||(this._loaderPromises.gltfLoader=this._initGltfLoaders()),this._loaderPromises.gltfLoader}_ensureObjLoader(){return this._loaderPromises.objLoader||(this._loaderPromises.objLoader=M(async()=>{const{OBJLoader:e}=await import("./vendor-three-BAfSiKEZ.js").then(s=>s.aO);return{OBJLoader:e}},[],import.meta.url).then(({OBJLoader:e})=>(this.loaders.objLoader=new e,this.loaders.objLoader))),this._loaderPromises.objLoader}_ensureHDRLoader(){return this._loaderPromises.HDRLoader||(this._loaderPromises.HDRLoader=M(async()=>{const{HDRLoader:e}=await import("./vendor-three-BAfSiKEZ.js").then(s=>s.aP);return{HDRLoader:e}},[],import.meta.url).then(({HDRLoader:e})=>(this.loaders.HDRLoader=new e,this.loaders.HDRLoader))),this._loaderPromises.HDRLoader}_ensureEXRLoader(){return this._loaderPromises.EXRLoader||(this._loaderPromises.EXRLoader=M(async()=>{const{EXRLoader:e}=await import("./vendor-three-BAfSiKEZ.js").then(s=>s.aQ);return{EXRLoader:e}},[],import.meta.url).then(({EXRLoader:e})=>(this.loaders.EXRLoader=new e,this.loaders.EXRLoader))),this._loaderPromises.EXRLoader}_ensureFontLoader(){return this._loaderPromises.fontLoader||(this._loaderPromises.fontLoader=M(async()=>{const{FontLoader:e}=await import("./vendor-three-BAfSiKEZ.js").then(s=>s.aR);return{FontLoader:e}},[],import.meta.url).then(({FontLoader:e})=>(this.loaders.fontLoader=new e,this.loaders.fontLoader))),this._loaderPromises.fontLoader}async _initGltfLoaders(){const[{GLTFLoader:e},{DRACOLoader:s},{KTX2Loader:i},{MeshoptDecoder:n}]=await Promise.all([M(()=>import("./vendor-three-BAfSiKEZ.js").then(u=>u.aS),[],import.meta.url),M(()=>import("./vendor-three-BAfSiKEZ.js").then(u=>u.aT),[],import.meta.url),M(()=>import("./vendor-three-BAfSiKEZ.js").then(u=>u.aU),[],import.meta.url),M(()=>import("./vendor-three-BAfSiKEZ.js").then(u=>u.aV),[],import.meta.url)]),o=new s;o.setDecoderPath("/draco/");const h=new i;return h.setTranscoderPath("/basis/"),await h.detectSupportAsync(this.renderer),this.loaders.gltfLoader=new e,this.loaders.gltfLoader.setDRACOLoader(o),this.loaders.gltfLoader.setKTX2Loader(h),this.loaders.gltfLoader.setMeshoptDecoder(n),this.loaders.gltfLoader}async startLoading(){for(const e of this.sources)switch(e.type){case"binModel":this.obfuscate.loadFile(e.path,o=>{this.obfuscate.decode(o,e.path,h=>{this.sourceLoaded(e,h)})});break;case"binJson":this.obfuscate.loadFile(e.path,o=>{this.obfuscate.decode(o,e.path,h=>{this.sourceLoaded(e,h)})});break;case"binTexture":this.obfuscate.loadFile(e.path,o=>{this.obfuscate.decode(o,e.path,h=>{const u=new Blob([h]);createImageBitmap(u).then(p=>{const y=new ls(p);y.needsUpdate=!0,this.sourceLoaded(e,y)}).catch(p=>console.error("Error texture loading:",p))})});break;case"gltfModel":(await this._ensureGltfLoader()).load(e.path,o=>{this.sourceLoaded(e,o)});break;case"objModel":await this._ensureObjLoader(),this.loaders.objLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"texture":this.loaders.textureLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"videoTexture":let i=document.createElement("video");i.src=e.path,i.setAttribute("crossorigin","anonymous"),i.muted=!0,i.loop=!0,i.load(),i.setAttribute("playsinline",""),i.setAttribute("webkit-playsinline",""),i.play();const n={videoTexture:new cs(i),videoElement:i};i.addEventListener("canplaythrough",()=>{this.sourceLoaded(e,n)});break;case"cubeTexture":this.loaders.cubeTextureLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"rgbeTexture":await this._ensureHDRLoader(),this.loaders.HDRLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"hdrTexture":await this._ensureHDRLoader(),this.loaders.HDRLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"exrTexture":await this._ensureEXRLoader(),this.loaders.EXRLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"font":await this._ensureFontLoader(),this.loaders.fontLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"audio":this.loaders.AudioLoader.load(e.path,o=>{this.sourceLoaded(e,o)});break;case"json":fetch(e.path).then(o=>{o.json().then(h=>(this.sourceLoaded(e,h),h))});break}this.sources.length===0&&setTimeout(()=>{this.loadedAll=!0,this.trigger("ready")})}sourceLoaded(e,s){this.items[e.name]=s,this.loaded++,this.loaded===this.toLoad&&(this.loadedAll=!0,this.trigger("ready"))}}class $s{constructor(){}setModel(){}setDebug(){}}class ei extends $s{constructor(e={}){super();r(this,"experience",g.getInstance());r(this,"debug",this.experience.debug);r(this,"state",this.experience.state);r(this,"input",experience.input);r(this,"time",experience.time);r(this,"renderer",experience.renderer.instance);r(this,"resources",experience.resources);r(this,"container",new Re);r(this,"uniforms",{iterations:d(l(128)),stepSize:d(l(.0071)),noiseFactor:d(l(0)),power:d(l(.3)),clamp1:d(l(.5)),clamp2:d(l(1)),originRadius:d(l(.13)),width:d(l(.03)),uvMotion:d(l(0)),rampCol1:d(N(1,1,1)),rampPos1:d(l(.05)),rampCol2:d(N(.65,.65,.68)),rampPos2:d(l(.425)),rampCol3:d(N(.12,.12,.14)),rampPos3:d(l(1)),rampEmission:d(l(2.2)),emissionColor:d(N(.1,.1,.12)),test1:d(l(0)),test2:d(l(0)),test3:d(l(1)),test4:d(l(1))});this.world=e.world,this.camera=this.world.camera.instance,this.scene=this.world.scene,this.transformControls=this.world.camera.transformControls,this.init(),this._setDebug()}testArrays(){const e=new SharedArrayBuffer(4*Float32Array.BYTES_PER_ELEMENT),s=new Int32Array(e,0,2);Atomics.store(s,0,99999999999999);const i=Atomics.load(s,0);console.log(i)}init(){this.setModel()}postInit(){}setModel(){const e=new hs(1,16,16),s=new ds({side:us});this.resources.items.noiseDeepTexture.wrapS=K,this.resources.items.noiseDeepTexture.wrapT=K,this.resources.items.noiseDeepTexture.needsUpdate=!0,s.colorNode=b(()=>{const n=this.uniforms.stepSize,o=this.uniforms.noiseFactor,h=this.uniforms.power,u=this.uniforms.originRadius,p=this.uniforms.width,y=this.uniforms.iterations,R=ms.mul(c(1,1,-1)).xzy,Q=U(0,ps.negate()),$=Oe.mul(Le).mul(c(1,1,-1)).xzy,W=m(R,$.xyz,Q),x=ce(_(Oe,bs)).mul(c(1,1,-1)).xzy.negate(),ue=Us(R.xy).mul(o),me=x.mul(ue),L=W.sub(me),j=c(0),X=l(0);fs(y,({i:ke})=>{const fe=ce(L),te=se(L),ge=n.mul(h).div(te.mul(te)),xe=gs(te,1,.5,0,1),ie=fe.mul(ge.mul(xe)),ne=x.sub(ie).normalize(),ae=x.mul(n);L.addAssign(ae);const I=se(L.mul(c(1,1,0))),we=I.mul(4.27).sub(xs.mul(.1)),Je=c(0,0,1),Ee=L.mul(Ns(Je,we)).mul(2),Ze=J(this.resources.items.noiseDeepTexture,Ee),Ke=p.negate(),Qe=c(Ke,0,p),Ae=_(Qe,c(L.z)),$e=Ae.mul(Ae).div(p),Ve=Z(p.sub($e).div(p),0),et=Ze.mul(Ve),ye=se(et),tt=Ee.mul(1.002),st=J(this.resources.items.noiseDeepTexture,tt).mul(Ve),it=se(st),nt=I.add(ye.sub(.78).mul(1.5)).add(ye.sub(it).mul(19.75)),at=v(this.uniforms.rampCol1,this.uniforms.rampPos1),ot=v(this.uniforms.rampCol2,this.uniforms.rampPos2),rt=v(this.uniforms.rampCol3,this.uniforms.rampPos3),ct=Ys(nt.x,at,ot,rt).mul(this.uniforms.rampEmission).add(this.uniforms.emissionColor),Be=se(L).lessThan(u),lt=m(ct,c(0),Be),ht=ws(L.z),dt=ye.sub(.75).mul(-.6),ut=ht.add(dt),mt=He(I,1,0,0,1),pt=He(ut,p,0,0,mt),Fe=m(pt,1,Be),bt=X.oneMinus().mul(je(Fe)),ft=m(j,lt,bt),gt=m(X,1,je(Fe));L.addAssign(ae),x.assign(ne),j.assign(ft),X.assign(gt)});const pe=x.mul(c(1,-1,1)).xzy,be=qs(J(this.resources.items.starsTexture,Ue(pe)).mul(this.state.uniforms.mainScene.environment.backgroundIntensity)),ee=l(1).sub(X),H=m(j,be,ee.mul(1));return Hs(H)})(),s.emissiveNode=s.colorNode;const i=new De(e,s);this.container.add(i),this.scene.add(this.container)}animationPipeline(){}resize(){}_setDebug(){if(!this.debug.active)return;const e=d(0),s=this.world.debugFolder.addFolder({title:"depth",expanded:!0});s.addBinding(e,"value",{label:"TEST"}),s.addBinding(this.uniforms.iterations,"value",{label:"Iterations"}),s.addBinding(this.uniforms.stepSize,"value",{label:"Step Size"}),s.addBinding(this.uniforms.noiseFactor,"value",{label:"Noise Factor",min:0,max:.1,step:1e-4}),s.addBinding(this.uniforms.power,"value",{label:"Power"}),s.addBinding(this.uniforms.clamp1,"value",{label:"Clamp 1"}),s.addBinding(this.uniforms.clamp2,"value",{label:"Clamp 2"}),s.addBinding(this.uniforms.originRadius,"value",{label:"Origin Radius"}),s.addBinding(this.uniforms.width,"value",{label:"Width"}),s.addBinding(this.uniforms.uvMotion,"value",{label:"UV Motion"}),s.addBinding(this.uniforms.rampCol1,"value",{label:"Ramp Col 1",color:{type:"float"}}),s.addBinding(this.uniforms.rampPos1,"value",{label:"Ramp Pos 1"}),s.addBinding(this.uniforms.rampCol2,"value",{label:"Ramp Col 2",color:{type:"float"}}),s.addBinding(this.uniforms.rampPos2,"value",{label:"Ramp Pos 2"}),s.addBinding(this.uniforms.rampCol3,"value",{label:"Ramp Col 3",color:{type:"float"}}),s.addBinding(this.uniforms.rampPos3,"value",{label:"Ramp Pos 3"}),s.addBinding(this.uniforms.rampEmission,"value",{label:"Ramp Emission"}),s.addBinding(this.uniforms.emissionColor,"value",{label:"Emission Color",color:{type:"float"}}),s.addBinding(this.uniforms.test1,"value",{label:"Fast Test 1"}),s.addBinding(this.uniforms.test2,"value",{label:"Fast Test 2"}),s.addBinding(this.uniforms.test3,"value",{label:"Fast Test 3"}),s.addBinding(this.uniforms.test4,"value",{label:"Fast Test 4"})}update(e){}}class ti extends F{constructor(){super();r(this,"experience",g.getInstance());r(this,"time",this.experience.time);r(this,"debug",this.experience.debug);r(this,"state",this.experience.state);r(this,"renderer",this.experience.renderer.instance);r(this,"scene",new ys);r(this,"camera",new Zs({world:this}));r(this,"input",new Se({camera:this.camera.instance}));r(this,"resources",this.experience.resources);r(this,"html",this.experience.html);r(this,"sound",this.experience.sound);r(this,"uniforms",this.state.uniforms.mainScene);r(this,"enabled",!0);this._setDebug(),this.init(),this.scene.add(this.camera.instance)}init(){this.blackHole=new ei({world:this}),this.environment=new Ks({world:this}),this.debugHelpers=new Js({world:this})}animationPipeline(){var e,s;(e=this.example)==null||e.animationPipeline(),(s=this.blackHole)==null||s.animationPipeline()}postInit(){var e,s;(e=this.example)==null||e.postInit(),(s=this.blackHole)==null||s.postInit()}resize(){var e,s,i;(e=this.example)==null||e.resize(),(s=this.blackHole)==null||s.resize(),(i=this.camera)==null||i.resize()}update(e){var s,i,n;this.enabled&&((s=this.debugHelpers)==null||s.update(e),(i=this.blackHole)==null||i.update(e),(n=this.camera)==null||n.update())}postUpdate(e){}_setDebug(){if(!this.debug.active)return;this.debugFolder=this.debug.panel.addFolder({title:"Main World",expanded:!0});const e=this.debugFolder.addFolder({title:"PostProcess",expanded:!1});e.addBinding(this.state.uniforms.mainScene.bloomPass.strength,"value",{min:0,max:5,step:.001,label:"Strength"}),e.addBinding(this.state.uniforms.mainScene.bloomPass.radius,"value",{min:-2,max:1,step:.001,label:"Radius"}),e.addBinding(this.state.uniforms.mainScene.bloomPass.threshold,"value",{min:0,max:1,step:.001,label:"Threshold"})}}class si extends F{constructor(){super(),this.experience=g.getInstance(),this.experience.worlds=this,this.setupWorlds()}setupWorlds(){this.mainWorld=new ti,this.experience.mainScene=this.mainWorld.scene,this.experience.mainCamera=this.mainWorld.camera}postInit(){var t;(t=this.mainWorld)==null||t.postInit(),this.postProcess=this.experience.postProcess}animationPipeline(){var t;(t=this.mainWorld)==null||t.animationPipeline()}resize(){var t;(t=this.mainWorld)==null||t.resize()}update(t){var e;(e=this.mainWorld)==null||e.update(t)}postUpdate(t){var e;(e=this.mainWorld)==null||e.postUpdate(t)}}class ii extends F{constructor(){super(),this.experience=g.getInstance(),this.postProcess=this.experience.postProcess,this.resources=this.experience.resources,this.debug=this.experience.debug,this.sizes=this.experience.sizes,this.isMobile=this.experience.isMobile,this.soundsCreated=!1,this.fftSize=128,this.floatTimeDomainData=new Float32Array(this.fftSize),this.byteFrequencyData=new Uint8Array(this.fftSize),this.volume=0,this.uniforms={tAudioDataBackground:d(0)}}isTabVisible(){return document.visibilityState==="visible"}handleVisibilityChange(){this.isTabVisible()?(this.backgroundSound.play(),this.listener.setMasterVolume(1)):(this.backgroundSound.pause(),this.listener.setMasterVolume(0))}createSounds(){this.soundsCreated!==!0&&(this.isMobile||(this.listener=new vs,this.backgroundSound=new Ps(this.listener),this.backgroundSound.setBuffer(this.resources.items.backgroundSound),this.backgroundSound.setLoop(!0),this.backgroundSound.setVolume(.8),this.backgroundSoundAnalyser=new Ls(this.backgroundSound,this.fftSize),this.soundsCreated=!0,document.addEventListener("visibilitychange",()=>this.handleVisibilityChange(),!1)))}getLevels(){const t=this.fftSize,e=8,s=Math.floor(t/e),i=[];for(let n=0;n<e;n++){let o=0;for(let u=0;u<s;u++)o+=this.byteFrequencyData[n*s+u];const h=o/s/256;i[n]=h}return i}getVolume(){let t=0;for(const e of this.floatTimeDomainData)t+=e*e;return Math.sqrt(t/this.floatTimeDomainData.length)}update(){this.isMobile}resize(){}}const ni=[{name:"displacementTexture",type:"texture",obfuscate:!0,path:"./textures/displacement.jpg",meta:{type:"texture"}},{name:"gridTexture",type:"texture",obfuscate:!0,path:"./textures/grass/grid.png",meta:{type:"texture"}},{name:"tileDataTexture",type:"texture",obfuscate:!0,path:"./textures/grass/tileData.jpg",meta:{type:"texture"}},{name:"starsTexture",type:"texture",obfuscate:!0,path:"./textures/hdr/nebula.png",meta:{type:"texture"}},{name:"noiseDeepTexture",type:"texture",obfuscate:!0,path:"./textures/noise_deep.png",meta:{type:"texture"}}],k=class k{static getInstance(){return k._instance||new k}constructor(){if(k._instance)return k._instance;k._instance=this,this.experience=g.getInstance(),this.debug=this.experience.debug,this.state=this.experience.state,this.materials={}}};r(k,"_instance",null);let Te=k;class ai{constructor(t){r(this,"experience",g.getInstance());r(this,"debug",this.experience.debug);r(this,"sizes",this.experience.sizes);r(this,"state",this.experience.state);r(this,"materials",Te.getInstance());r(this,"rendererClass",this.experience.renderer);r(this,"scene",experience.scene);r(this,"time",experience.time);r(this,"resources",experience.resources);r(this,"timeline",experience.time.timeline);r(this,"container",new Re);r(this,"passes",{});r(this,"transitionPassParams",{progress:d(0),threshold:d(.1),useTexture:d(1),uvScale:d(S(1,1)),uvOffset:d(S(0,0))});this.renderer=t,this.composer=new zs(this.renderer)}postInit(){this.worlds=this.experience.worlds,this.mainWorld=this.worlds.mainWorld,this.setComposer(),this.setDebug()}setComposer(){this._sceneMainPass(),this.composer.outputNode=this.scenePassColorMain.add(this.bloomPassMain)}_setTextures(){const t=this.displacementTexture=this.resources.items.displacementTexture;t.wrapS=K,t.wrapT=K,this._calculateUVTransform(t),this.uResolution=this.state.uniforms.resolution,this.displacementTextureNode=J(this.displacementTexture,Ms().mul(this.transitionPassParams.uvScale).add(this.transitionPassParams.uvOffset).mul(this.uniforms.transitionPassParams.uvMultiplier))}_sceneMainPass(){const t=Ss(this.mainWorld.scene,this.mainWorld.camera.instance,{});t.setMRT(Ts({output:_s,emissive:Cs}));const e=this.scenePassColorMain=t.getTextureNode("output");t.getTextureNode("emissive");const s=this.bloomPassMain=this.passes.bloomPassMain=Rs(e,this.state.uniforms.mainScene.bloomPass.strength,this.state.uniforms.mainScene.bloomPass.radius,this.state.uniforms.mainScene.bloomPass.threshold);s.strength=this.state.uniforms.mainScene.bloomPass.strength,s.radius=this.state.uniforms.mainScene.bloomPass.radius,s.threshold=this.state.uniforms.mainScene.bloomPass.threshold}_transitionPass(){const t=b(e=>{const s=e.noiseTexture,i=e.uResolution.toVar(),n=i.x.div(i.y).toVar();let o=ve.div(S(1,n)).toVar(),h=Ds(o,S(.5,l(.5).div(n))).toVar();return h=h.mul(s.r),v(h)});this.transitionPass=transition(this.scenePassMainFinalColor,this.scenePassPreloadFinalColor,t({uResolution:this.state.uniforms.resolution,noiseTexture:this.displacementTextureNode}),this.uniforms.transitionPassParams.progress,this.uniforms.transitionPassParams.threshold,this.uniforms.transitionPassParams.useTexture)}setDisplacementPass(t,e){this.composer.outputNode=b(s=>{const i=l(3.1415),n=i.mul(.25),o=i.mul(-.75),h=We(t),u=We(e),p=this.displacementTextureNode,y=S(p.r,p.g),R=getRotM(n).mul(y.mul(this.uniforms.displacementPassParams.intensity).mul(this.uniforms.displacementPassParams.progress)),Q=ve.sub(R.yx),$=h.sample(Q).toVar(),W=getRotM(o).mul(y.mul(this.uniforms.displacementPassParams.intensity).mul(l(1).sub(this.uniforms.displacementPassParams.progress))).toVar(),z=ve.sub(W.yx).toVar(),x=u.sample(z).toVar();return w(z.y.greaterThan(1),()=>{x.assign(v(0))}),w(z.y.lessThan(0),()=>{x.assign(v(0))}),w(z.x.greaterThan(1),()=>{x.assign(v(0))}),w(z.x.lessThan(0),()=>{x.assign(v(0))}),m($,x,this.uniforms.displacementPassParams.progress)})({})}_calculateUVTransform(){const{uvScale:t,uvOffset:e}=Es(this.displacementTexture,this.sizes);this.transitionPassParams.uvScale.value.set(t.x,t.y),this.transitionPassParams.uvOffset.value.set(e.x,e.y)}resize(){this.composer.needsUpdate=!0}setDebug(){this.debug.active&&this.debug.panel}productionRender(){return this.composer.render()}debugRender(){return this.composer.render()}update(t){return this.debug.active?this.debugRender():this.productionRender()}}const Y={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return Y.Android()||Y.BlackBerry()||Y.iOS()||Y.Opera()||Y.Windows()}},E=class E extends F{constructor(){if(E._instance)return E._instance;super();r(this,"experience",g.getInstance());r(this,"sizes",this.experience.sizes);E._instance=this,this.init()}static getInstance(){return E._instance||new E}init(){this.preloader=document.getElementById("preloader"),this.playButton=document.getElementById("play-button")}hardRemovePreloader(){this.playButton.classList.replace("fade-in","fade-out"),this.preloader.classList.add("preloaded"),this.preloader.remove(),this.playButton.remove()}};r(E,"_instance",null);let Ce=E;const A=class A extends F{constructor(e){super();r(this,"appLoaded",!1);r(this,"firstRender",!1);if(A._instance)return A._instance;if(A._instance=this,window.experience=this,this.html={},this.html.preloader=document.getElementById("preloader"),this.html.playButton=document.getElementById("play-button"),this.isMobile=Y.any(),this.canvas=e,!this.canvas){console.warn("Missing 'Canvas' property");return}this.setDefaultCode(),this.init()}static getInstance(){return A._instance||new A}init(){this.timeline=ze.timeline({paused:!0}),this.debug=new Vs,this.sizes=new As,this.time=new Bs,this.ui=new Ce,this.renderer=new Is,this.state=new Fs,this.sound=new ii,this.resources=new Qs(ni),this.mainCamera=void 0,this.mainScene=void 0,this.state.postprocessing&&(this.postProcess=new ai(this.renderer.instance)),this.resources.on("ready",()=>{this.time.reset(),this.worlds=new si,this.postInit(),this.setListeners(),this.animationPipeline(),this.trigger("classesReady"),window.dispatchEvent(new CustomEvent("3d-app:classes-ready")),this.appLoaded=!0})}animationPipeline(){var e;(e=this.worlds)==null||e.animationPipeline()}postInit(){var e,s,i;this.renderer.postInit(),(e=this.postProcess)==null||e.postInit(),(s=this.worlds)==null||s.postInit(),(i=this.debug)==null||i.postInit()}resize(){var e,s,i,n;this.worlds.resize(),this.renderer.resize(),(e=this.postProcess)==null||e.resize(),(s=this.debug)==null||s.resize(),(i=this.state)==null||i.resize(),(n=this.sound)==null||n.resize()}async render(){return this.state.postprocessing?this.postProcess.update(this.time.delta):this.renderer.update(this.time.delta)}async update(){var e,s;this.worlds.update(this.time.delta),this.render(),this.debug.active&&this.debug.update(this.time.delta),await this.postUpdate(this.time.delta),(s=(e=this.debug)==null?void 0:e.stats)==null||s.update()}_fireReady(){this.trigger("ready"),window.dispatchEvent(new CustomEvent("3d-app:ready")),this.firstRender="done"}async postUpdate(e){this.firstRender===!0&&(window.dispatchEvent(new CustomEvent("app:first-render")),this._fireReady()),this.resources.loadedAll&&this.appLoaded&&this.firstRender===!1&&(await this.render(),this.firstRender=!0),this.worlds.postUpdate(e)}setListeners(){this.sizes.on("resize",()=>{this.resize()}),this.renderer.instance.setAnimationLoop(async()=>this.update())}setDefaultCode(){document.ondblclick=function(e){e.preventDefault()},ze.registerPlugin(ks)}startWithPreloader(){this.ui.playButton.classList.add("fade-in"),this.ui.playButton.addEventListener("click",()=>{this.ui.playButton.classList.replace("fade-in","fade-out"),setTimeout(()=>{this.time.reset(),this.setupWorlds(),this.ui.preloader.classList.add("preloaded"),setTimeout(()=>{this.ui.preloader.remove(),this.ui.playButton.remove()},2500)},100)},{once:!0})}destroy(){this.sizes.off("resize"),this.time.off("tick"),this.scene.traverse(e=>{if(e instanceof De){e.geometry.dispose();for(const s in e.material){const i=e.material[s];i&&typeof i.dispose=="function"&&i.dispose()}}}),this.camera.controls.dispose(),this.renderer.instance.dispose(),this.debug.active&&this.debug.ui.destroy()}};r(A,"_instance",null);let g=A;export{g as default};
